var MashupFormTypeEnum,GnMashupTokenOptions,__extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])})(e,t)};return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}}(),BaseNavigableItem=function(e){e&&jQuery.extend(this,e),!this.LoginName&&e.Creator&&(this.LoginName=e.Creator),this.UniqueKey?(this.LoginName=GetLoginNameFromUniqueKey(this.UniqueKey),this.CreationTicks=GetTicksFromUniqueKey(this.UniqueKey)):this.CreationTicks&&(this.UniqueKey=GetUniqueKey(this.LoginName,this.CreationTicks))},NoseDto=function(a){function e(e){var t=a.call(this,e)||this;return t.IsInCommunity=function(e){return t.Communities&&-1!=jQuery.inArray(e,t.Communities)},t.ThumbSize="@200",t.ImageUrl=function(){return gnSettings.BaseDataUrl+"/profimg/"+encodeURIComponent(t.LoginName)},t.ThumbUrl=function(){return t.ImageUrl()+t.ThumbSize},t.PreviewUrl=function(){return"/nose/preview/"+encodeURIComponent(t.LoginName)},t.DetailUrl=function(){return(MA_GPSNOSE_IS_MASHUP?gnSettings.BaseUrl:"")+"/n/"+encodeURIComponent(t.LoginName)+(MA_GPSNOSE_IS_MASHUP&&gnSettings.LoginId?"?lid="+gnSettings.LoginId:"")},t.ShareUrl=function(){return gnSettings.BaseUrl+"/n/"+encodeURIComponent(t.LoginName)},t}return __extends(e,a),e}(BaseNavigableItem),MashupAdminViewModel=(window.MAX_DATE_TIME_TICKS="3155378975999999999",!function(e){e[e.None=0]="None",e[e.Add=1]="Add",e[e.Edit=2]="Edit",e[e.Detail=3]="Detail",e[e.MashupToken=4]="MashupToken"}(MashupFormTypeEnum=MashupFormTypeEnum||{}),!function(e){e[e.NoOptions=0]="NoOptions",e[e.BatchScanning=1]="BatchScanning",e[e.CanSelectAmount=2]="CanSelectAmount",e[e.CanComment=4]="CanComment",e[e.AskGpsSharing=8]="AskGpsSharing"}(GnMashupTokenOptions=GnMashupTokenOptions||{}),function(){function e(e){var s=this;this.OwnMashups=ko.observableArray([]),this.CurrentMashup=ko.observable(),this.MashupTokenCallbackUrlValue=ko.observable("n/a"),this.MashupTokenCallbackUrlMaxChars=ko.observable(0),this.MashupTokenCallbackUrlIsValid=ko.observable(!1),this.FormType=ko.observable(MashupFormTypeEnum.None),this.RequestActiveOwnMashups=ko.observable(!1),this.RequestActiveRegisterCommunity=ko.observable(!1),this.RequestActiveValidateCommunity=ko.observable(!1),this.RequestActiveRegenerateAppKey=ko.observable(!1),this.RequestActiveUpdateCommunity=ko.observable(!1),this.RequestActiveAddSubCommunity=ko.observable(!1),this.RequestActiveDelSubCommunity=ko.observable(!1),this.RequestActiveMashupTokenNew=ko.observable(!1),this.AddMaxCount=ko.observable(0),this.AddMaxChars=ko.observable(0),this.PrivacyDropdownItems=ko.observableArray([]),this.PrivacyLabel=ko.observable(""),this.PrivacyIndex=ko.observable(-1),this.RegisterCommunityValue=ko.observable(""),this.RegisterCommunityIsValid=ko.observable(!1),this.AddSubCommunityValue=ko.observable(""),this.AddSubCommunityMaxChars=ko.observable(0),this.AddSubCommunityIsValid=ko.observable(!1),this.Hosts=ko.observableArray([]),this.AddHostValue=ko.observable(""),this.AddHostMaxChars=ko.observable(0),this.AddHostIsValid=ko.observable(!1),this.CreateMashupTokenPayload=ko.observable(""),this.CreateMashupTokenMaxPayloadChars=ko.observable(0),this.CreateMashupTokenLabel=ko.observable(""),this.CreateMashupTokenMaxLabelChars=ko.observable(0),this.CreateMashupTokenValuePerUnit=ko.observable(""),this.CreateMashupTokenDate=ko.observable(""),this.CreateMashupTokenSrc=ko.observable(""),this.CreateMashupTokenPayloadIsValid=ko.computed(function(){var e=s.CreateMashupTokenPayload();return 0<e.length&&e.length<=s.CreateMashupTokenMaxPayloadChars()}),this.CreateMashupTokenLabelIsValid=ko.computed(function(){return s.CreateMashupTokenLabel().length<=s.CreateMashupTokenMaxLabelChars()}),this.CreateMashupTokenValuePerUnitIsValid=ko.computed(function(){var e=s.CreateMashupTokenValuePerUnit();return/^\d{0,6}(\.\d{1,3})?$/.test(e)}),this.CreateMashupTokenIsValid=ko.computed(function(){return s.CreateMashupTokenPayloadIsValid()&&s.CreateMashupTokenLabelIsValid()&&s.CreateMashupTokenValuePerUnitIsValid()}),this.CreateMashupTokenBatchScanning=ko.observable(!1),this.CreateMashupTokenCanSelectAmount=ko.observable(!1),this.CreateMashupTokenCanComment=ko.observable(!1),this.CreateMashupTokenAskGpsSharing=ko.observable(!1),this.CreateMashupTokenOptions=ko.computed({owner:this,read:function(){var e=s.CreateMashupTokenBatchScanning(),t=s.CreateMashupTokenCanSelectAmount(),a=s.CreateMashupTokenCanComment(),o=s.CreateMashupTokenAskGpsSharing(),n=GnMashupTokenOptions.NoOptions;return(n+=e?GnMashupTokenOptions.BatchScanning:0)+(t?GnMashupTokenOptions.CanSelectAmount:0)+(a?GnMashupTokenOptions.CanComment:0)+(o?GnMashupTokenOptions.AskGpsSharing:0)},write:function(e){s.CreateMashupTokenBatchScanning((e&GnMashupTokenOptions.BatchScanning)==GnMashupTokenOptions.BatchScanning),s.CreateMashupTokenCanSelectAmount((e&GnMashupTokenOptions.CanSelectAmount)==GnMashupTokenOptions.CanSelectAmount),s.CreateMashupTokenCanComment((e&GnMashupTokenOptions.CanComment)==GnMashupTokenOptions.CanComment),s.CreateMashupTokenAskGpsSharing((e&GnMashupTokenOptions.AskGpsSharing)==GnMashupTokenOptions.AskGpsSharing)}}),this.MashupTokenPageUrl="/MashupApi/GetMashupTokensPage",this.MashupTokens=ko.observableArray([]),this.MashupTokensPageSize=gnSettings.MashupTokensPageSize,this.MashupTokensLastKnownTicks="0",this.HasMoreMashupTokens=ko.observable(!0),this.MashupTokensRequestActive=ko.observable(!1),this.IsAddAllowed=ko.computed(function(){return s.OwnMashups().length<s.AddMaxCount()}),this.IsAddSubCommunityAllowed=ko.computed(function(){return null!=s.CurrentMashup()&&s.CurrentMashup().SubCommunities().length<s.CurrentMashup().MaxSubSites()}),this.IsAddHostAllowed=ko.computed(function(){return null!=s.CurrentMashup()&&s.Hosts().length<s.CurrentMashup().MaxHosts()}),this.AddMaxCount(e.MaxMashups||1),this.AddMaxChars(100),this.AddSubCommunityMaxChars(20),this.AddHostMaxChars(100),this.CreateMashupTokenMaxPayloadChars(50),this.CreateMashupTokenMaxLabelChars(150),this.MashupTokenCallbackUrlMaxChars(1e3),this.PrivacyDropdownItems.push("%"+GetLangRes("Common_lblCommunityPublic","Public")),this.PrivacyDropdownItems.push("@"+GetLangRes("Common_lblCommunityClosed","Closed")),this.PrivacyDropdownItems.push("*"+GetLangRes("Common_lblCommunityPrivate","Private")),this.PrivacyIndex.subscribe(function(e){s.PrivacyLabel(s.PrivacyDropdownItems()[e])}),this.PrivacyIndex(0),this.RegisterCommunityValue.subscribe(function(e){e=IsValidDomain(e,s.AddMaxChars());s.RegisterCommunityIsValid(e),s.CurrentMashup(null)}),this.AddSubCommunityValue.subscribe(function(e){e=IsValidCommunity(e,s.AddSubCommunityMaxChars());s.AddSubCommunityIsValid(e)}),this.AddHostValue.subscribe(function(e){e=IsValidDomain(e,s.AddHostMaxChars());s.AddHostIsValid(e)}),this.CreateMashupTokenPayload.subscribe(function(e){s.CreateMashupTokenSrc("")}),this.CreateMashupTokenDate.subscribe(function(e){s.CreateMashupTokenSrc("")}),this.CreateMashupTokenOptions.subscribe(function(e){s.CreateMashupTokenSrc("")}),this.MashupTokenCallbackUrlValue.subscribe(function(e){var t=s.CurrentMashup()?s.CurrentMashup().CommunityTagSufix():null,e=0==e.length||IsValidUrl(e,s.MashupTokenCallbackUrlMaxChars(),t);s.MashupTokenCallbackUrlIsValid(e)})}return e.prototype.OnAddMashupTokens=function(){},e.prototype.AddMashupTokens=function(e){if(null!=e){if(0<e.length){for(var t in e){t=new MashupTokenDto(e[t]);t.ScannedTicks()>this.MashupTokensLastKnownTicks&&(this.MashupTokensLastKnownTicks=t.ScannedTicks()),this.MashupTokens.push(t)}e.length%this.MashupTokensPageSize!=0&&this.HasMoreMashupTokens(!1)}else this.HasMoreMashupTokens(!1);this.OnAddMashupTokens&&this.OnAddMashupTokens()}},e.prototype.PageMashupTokens=function(){var t=this;this.MashupTokensRequestActive()||(this.MashupTokensRequestActive(!0),jQuery.ajax({type:"POST",url:this.MashupTokenPageUrl,cache:!1,data:JSON.stringify({appKey:this.CurrentMashup().AppKey(),lastKnownScanTicks:this.MashupTokensLastKnownTicks,pageSize:this.MashupTokensPageSize}),dataType:"json",contentType:"application/json",success:function(e){"object"!=typeof e?(dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),null!==console&&void 0!==console&&console.warn(e)):e&&0<e.length?t.AddMashupTokens(e):t.HasMoreMashupTokens(!1),t.MashupTokensRequestActive(!1)},error:function(e){429!=e.status&&dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorCannotPage","Page cannot be loaded!"),null),t.MashupTokensRequestActive(!1)}}))},e.prototype.OnEditMashup=function(e){},e.prototype.EditMashup=function(e){this.CurrentMashup(e),this.FormType(MashupFormTypeEnum.Edit),this.MashupTokenCallbackUrlValue(e.MashupTokenCallbackUrl()),this.AddHostValue(""),this.Hosts(e.Hosts().slice(0)),this.OnEditMashup&&this.OnEditMashup(e)},e.prototype.OnDetailMashup=function(e){},e.prototype.DetailMashup=function(e){this.CurrentMashup(e),this.FormType(MashupFormTypeEnum.Detail),this.OnDetailMashup&&this.OnDetailMashup(e)},e.prototype.OnMashupToken=function(e){},e.prototype.MashupToken=function(e){this.CurrentMashup(e),this.HasMoreMashupTokens(!0),this.MashupTokens([]),this.FormType(MashupFormTypeEnum.MashupToken),this.OnMashupToken&&this.OnMashupToken(e)},e.prototype.GetCommunityNameFromAdd=function(e){return this.GetCommunityPrefix(this.PrivacyDropdownItems()[this.PrivacyIndex()])+e},e.prototype.GetCommunityHtml=function(e,t){var a="";switch(this.GetCommunityPrefix(e)){case"@":a="fas fa-lock";break;case"*":a="fas fa-eye-slash";break;case"%":a="fas fa-globe-americas"}return t=t?" "+t:"",""!=a&&e&&2<e.length?'<i class="'+a+'"></i> <span class="keyword-label'+t+'"> '+e.substr(1,e.length)+"</span>":'<i class="fas fa-globe-americas"></i> <span class="keyword-label'+t+'"> '+e+"</span>"},e.prototype.GetCommunityPrefix=function(e){return!e||e.length<1?"%":e.charAt(0)},e.prototype.GetOwnMashups=function(){var a=this;a.RequestActiveOwnMashups()||(a.RequestActiveOwnMashups(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/GetOwnMashups",cache:!1,data:JSON.stringify({}),dataType:"json",contentType:"application/json",success:function(e){a.RequestActiveOwnMashups(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):ko.utils.arrayForEach(e,function(e,t){a.OwnMashups.push(new MashupDto(e))})},error:function(){a.RequestActiveOwnMashups(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}}))},e.prototype.RegisterCommunity=function(){var t,a,o=this;o.RequestActiveRegisterCommunity()||(o.CurrentMashup(null),t=this.GetCommunityNameFromAdd(this.RegisterCommunityValue()),a=!0,ko.utils.arrayForEach(o.OwnMashups(),function(e,t){e.CommunityTagSufix()==o.RegisterCommunityValue()&&(a=!1)}),a?(o.RequestActiveRegisterCommunity(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/RegisterCommunityWeb",cache:!1,data:JSON.stringify({tag:t}),dataType:"json",contentType:"application/json",success:function(e){o.RequestActiveRegisterCommunity(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):o.CurrentMashup(new MashupDto({CommunityTag:t,ValidationKey:e.ValidationKey}))},error:function(){o.RequestActiveRegisterCommunity(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}})):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblDuplicateItem","There is already an entry with the same name!"),null))},e.prototype.ValidateCommunity=function(){var e,a=this;a.RequestActiveValidateCommunity()||(e=this.GetCommunityNameFromAdd(this.RegisterCommunityValue()),a.RequestActiveValidateCommunity(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/ValidateCommunityWeb",cache:!1,data:JSON.stringify({tag:e}),dataType:"json",contentType:"application/json",success:function(e){var t;a.RequestActiveValidateCommunity(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):(null!=(t=a.CurrentMashup())&&(t.AppKey(e.AppKey),t.ValidationTicks(GetTicksFromDate(new Date)),a.OwnMashups.push(t)),a.FormType(MashupFormTypeEnum.None),a.RegisterCommunityValue(""),a.CurrentMashup(null))},error:function(){a.RequestActiveValidateCommunity(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}}))},e.prototype.AddHost=function(){var e;null!=this.CurrentMashup()&&(this.Hosts().indexOf(this.AddHostValue())<0?((e=this.Hosts().slice(0)).push(this.AddHostValue()),this.Hosts(e),this.AddHostValue("")):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblDuplicateItem","There is already an entry with the same name!"),null))},e.prototype.RemoveHost=function(e){var t;null!=this.CurrentMashup()&&((t=this.Hosts().slice(0)).splice(t.indexOf(e),1),this.Hosts(t))},e.prototype.UpdateCommunity=function(){var t;null==this.CurrentMashup()||(t=this).RequestActiveUpdateCommunity()||(t.RequestActiveUpdateCommunity(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/UpdateCommunityWeb",cache:!1,data:JSON.stringify({tag:t.CurrentMashup().CommunityTag(),hosts:this.Hosts().slice(0),mashupTokenCallbackUrl:t.MashupTokenCallbackUrlValue()}),dataType:"json",contentType:"application/json",success:function(e){t.RequestActiveUpdateCommunity(!1),t.CurrentMashup()&&(t.CurrentMashup().Hosts([]),t.CurrentMashup().Hosts(t.Hosts().slice(0)),t.CurrentMashup().MashupTokenCallbackUrl(t.MashupTokenCallbackUrlValue())),t.AddHostValue("")},error:function(){t.RequestActiveUpdateCommunity(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}}))},e.prototype.RegenerateAppKey=function(){var a=this;null!=this.CurrentMashup()&&dialog.ShowDestructive(GetLangRes("Common_lblAreYouSureTitle","Are you sure?"),GetLangRes("Common_lblAreYouSureMessage","This can not be undone, proceed anyway?"),function(){dialog.Hide();var e,t=a;t.RequestActiveRegenerateAppKey()||(e=t.CurrentMashup().CommunityTag(),t.RequestActiveRegenerateAppKey(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/RegenerateAppKey",cache:!1,data:JSON.stringify({tag:e}),dataType:"json",contentType:"application/json",success:function(e){t.RequestActiveRegenerateAppKey(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):t.CurrentMashup()&&t.CurrentMashup().AppKey(e.AppKey)},error:function(){t.RequestActiveRegenerateAppKey(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}}))})},e.prototype.AddSubCommunity=function(){var t,a;null==this.CurrentMashup()||(t=this).RequestActiveAddSubCommunity()||(a=t.GetCommunityNameFromAdd(t.CurrentMashup().CommunityTagSufix())+"@"+t.AddSubCommunityValue(),t.CurrentMashup().SubCommunities().indexOf(a)<0?(t.RequestActiveAddSubCommunity(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/AddSubCommunity",cache:!1,data:JSON.stringify({tag:a}),dataType:"json",contentType:"application/json",success:function(e){t.RequestActiveAddSubCommunity(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):((e=t.CurrentMashup().SubCommunities().slice(0)).push(a),t.CurrentMashup().SubCommunities([]),t.CurrentMashup().SubCommunities(e),t.AddSubCommunityValue(""))},error:function(){t.RequestActiveAddSubCommunity(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}})):dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblDuplicateItem","There is already an entry with the same name!"),null))},e.prototype.DelSubCommunity=function(a){var e=this;dialog.ShowDestructive(GetLangRes("Common_lblAreYouSureTitle","Are you sure?"),GetLangRes("Common_lblAreYouSureMessage","This can not be undone, proceed anyway?"),function(){dialog.Hide();var t=e;t.RequestActiveDelSubCommunity()||(t.RequestActiveDelSubCommunity(!0),jQuery.ajax({type:"POST",url:"/MashupAdmin/DelSubCommunity",cache:!1,data:JSON.stringify({tag:a}),dataType:"json",contentType:"application/json",success:function(e){t.RequestActiveDelSubCommunity(!1),0<e.ErrorCode?dialog.Show(GetLangRes("Common_lblError","Error"),e.Message,null):((e=t.CurrentMashup().SubCommunities().slice(0)).splice(e.indexOf(a),1),t.CurrentMashup().SubCommunities([]),t.CurrentMashup().SubCommunities(e),t.AddSubCommunityValue(""))},error:function(){t.RequestActiveDelSubCommunity(!1),dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null)}}))})},e.prototype.CreateMashupToken=function(){var e,a=this;a.CreateMashupTokenIsValid()&&null!=a.CurrentMashup()?a.RequestActiveMashupTokenNew()||(a.RequestActiveMashupTokenNew(!0),(e={}).appKey=a.CurrentMashup().AppKey(),e.tag=a.CurrentMashup().CommunityTag(),e.payload=a.CreateMashupTokenPayload(),e.label=a.CreateMashupTokenLabel(),e.valuePerUnit=a.CreateMashupTokenValuePerUnit(),a.CreateMashupTokenOptions()>GnMashupTokenOptions.NoOptions&&(e.options=a.CreateMashupTokenOptions()),a.CreateMashupTokenDate()&&0<a.CreateMashupTokenDate().length&&(e.validToTicks=GetTicksFromDate(moment.utc(a.CreateMashupTokenDate()).add(1,"d").toDate())),$.ajax({type:"POST",url:"/MashupApi/GenerateQrTokenForMashup",data:JSON.stringify(e),contentType:"application/json",xhr:function(){var e=new XMLHttpRequest;return e.responseType="blob",e},success:function(e){try{var t=new FileReader;t.addEventListener("load",function(){a.CreateMashupTokenSrc(t.result),a.RequestActiveMashupTokenNew(!1)},!1),t.readAsDataURL(e)}catch(e){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null),a.RequestActiveMashupTokenNew(!1)}},error:function(){dialog.Show(GetLangRes("Common_lblError","Error"),GetLangRes("Common_lblErrorContentUnavailable","The requested content cannot be loaded. <br/> Please try again later."),null),a.RequestActiveMashupTokenNew(!1)}})):a.CreateMashupTokenSrc("")},e}()),MashupDto=function(){function e(e){this.CommunityTag=ko.observable(""),this.ValidationKey=ko.observable(""),this.AppKey=ko.observable(""),this.ValidationTicks=ko.observable("0"),this.Hosts=ko.observableArray([]),this.SubCommunities=ko.observableArray([]),this.History=ko.observableArray([]),this.MaxSubSites=ko.observable(0),this.MaxHosts=ko.observable(0),this.MaxCallsDaily=ko.observable(0),this.MaxCallsMonthly=ko.observable(0),this.MashupTokenCallbackUrl=ko.observable(""),this.CommunityTag(e.CommunityTag),this.ValidationKey(e.ValidationKey),this.AppKey(e.AppKey),this.ValidationTicks(e.ValidationTicks),this.MaxSubSites(e.MaxSubSites||3),this.MaxHosts(e.MaxHosts||3),this.MaxCallsDaily(e.MaxCallsDaily||500),this.MaxCallsMonthly(e.MaxCallsMonthly||5e3),this.MashupTokenCallbackUrl(e.MashupTokenCallbackUrl||"");var a=this;if(e.Hosts&&ko.utils.arrayForEach(e.Hosts,function(e,t){a.Hosts.push(e)}),e.SubCommunities&&ko.utils.arrayForEach(e.SubCommunities,function(e,t){a.SubCommunities.push(e)}),e.CallHistory)for(var t in e.CallHistory){var o=e.ExceededQuotaHistory[t];a.History.push(new HistoryDto(t,e.CallHistory[t],0<o?o:0))}if(e.ExceededQuotaHistory)for(var t in e.ExceededQuotaHistory)null==e.CallHistory[t]&&a.History.push(new HistoryDto(t,0,e.ExceededQuotaHistory[t]))}return e.prototype.CommunityTagPrefix=function(){return this.CommunityTag().substring(0,1)},e.prototype.CommunityTagSufix=function(){return this.CommunityTag().substring(1,this.CommunityTag().length)},e}(),HistoryDto=function(e,t,a){this.Ticks=e,this.Call=t,this.ExQuota=a},MashupTokenDto=function(e){this.NoseDto=ko.observable(),this.Payload=ko.observable(""),this.ScannedByLoginName=ko.observable(""),this.ScannedLatitude=ko.observable(0),this.ScannedLongitude=ko.observable(0),this.ScannedTicks=ko.observable("0"),this.RecordedTicks=ko.observable("0"),this.CallbackResponseHttpCode=ko.observable(0),this.CallbackResponseMessage=ko.observable(""),this.Payload(e.Payload),this.ScannedByLoginName(e.ScannedByLoginName),this.ScannedLatitude(e.ScannedLatitude),this.ScannedLongitude(e.ScannedLongitude),this.ScannedTicks(e.ScannedTicks),this.RecordedTicks(e.RecordedTicks),this.CallbackResponseHttpCode(e.CallbackResponseHttpCode),this.CallbackResponseMessage(e.CallbackResponseMessage),this.NoseDto(new NoseDto({LoginName:this.ScannedByLoginName()}))};